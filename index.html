<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DNS Lookup</title>

  <link rel="icon" type="image/svg+xml" href="./favicon.svg">

  <!-- Bootstrap 5.3.8 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" rel="stylesheet">

  <style>
    /* Layout helpers */
    body,
    html {
      height: 100%;
      /* Static background image */
      background-image: url('background.png');
      background-size: 841px 616px;
      background-repeat: no-repeat;
      background-position: center center;
      background-attachment: fixed;
      /* Ensure background is always visible */
      background-color: #fff;
    }

    .center-area {
      min-height: 100vh;
    }

    /* Input/button width: fixed but responsive */
    .lookup-box {
      width: 420px;
      max-width: calc(100% - 40px);
    }

    /* Results area is wider than the input (per request) but remains responsive */
    .results-area {
      width: 700px;
      max-width: calc(100% - 40px);
      background-color: #f1f1f1;
      border-radius: .25rem;
      padding: 16px;
      min-height: 80px;
    }

    .result-row input.form-control {
      cursor: pointer;
      /* clicking copies */
    }

    .copied-badge {
      transition: opacity .25s ease;
    }

    .main-content {
      background: rgba(255, 255, 255, 0.4);
      padding: 1rem;
    }
  </style>
</head>

<body>
  <div class="d-flex justify-content-center align-items-center center-area">
    <div class="text-center main-content">

      <div class="lookup-box mx-auto">
        <input id="queryInput" class="form-control" type="text" maxlength="255" value="happykids2019.cameraddns.net"
          placeholder="Enter domain (e.g. example.com)" aria-label="Domain or hostname" />

        <button id="searchBtn" class="btn btn-primary mt-2 w-100" type="button">
          Search
        </button>
      </div>

      <div id="results" class="results-area mt-4 mx-auto" aria-live="polite" aria-atomic="true">
        <!-- Results (each row is an input readonly) will be injected here -->
        <div id="placeholder" class="text-muted">Results will appear here. Click any result to copy it.</div>
      </div>
    </div>
  </div>

  <!-- Bootstrap 5.3.8 Bundle (includes Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    (function () {
      const input = document.getElementById('queryInput');
      const btn = document.getElementById('searchBtn');
      const results = document.getElementById('results');
      const placeholder = document.getElementById('placeholder');

      // Helper: set button to loading state
      function setLoading(loading) {
        if (loading) {
          btn.disabled = true;
          btn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Searching...';
        } else {
          btn.disabled = false;
          btn.innerHTML = 'Search';
        }
      }

      // Show a short inline message in results area
      function showMessage(msg, type = 'muted') {
        results.innerHTML = '<div class="text-' + type + '">' + msg + '</div>';
      }

      // Clear results area
      function clearResults() {
        results.innerHTML = '';
      }

      // Create a result row (an input readonly that copies on click)
      function createResultRow(value) {
        const row = document.createElement('div');
        row.className = 'result-row d-flex align-items-center mb-2';

        const inp = document.createElement('input');
        inp.type = 'text';
        inp.className = 'form-control';
        inp.readOnly = true;
        inp.value = value;
        inp.title = 'Click to copy';

        // Clicking the input copies the value to clipboard and shows small feedback
        inp.addEventListener('click', async () => {
          try {
            // Use Clipboard API if available
            if (navigator.clipboard && navigator.clipboard.writeText) {
              await navigator.clipboard.writeText(inp.value);
            } else {
              // Fallback: select & execCommand
              inp.select();
              document.execCommand('copy');
              window.getSelection().removeAllRanges();
            }

            // Show transient badge
            let badge = row.querySelector('.copied-badge');
            if (!badge) {
              badge = document.createElement('span');
              badge.className = 'badge bg-success ms-2 copied-badge';
              badge.textContent = 'Copied!';
              row.appendChild(badge);
            }
            badge.style.opacity = '1';
            setTimeout(() => {
              badge.style.opacity = '0';
            }, 900);
          } catch (e) {
            console.error('Copy failed', e);
            // provide a user-visible fallback
            let badge = row.querySelector('.copied-badge');
            if (!badge) {
              badge = document.createElement('span');
              badge.className = 'badge bg-danger ms-2 copied-badge';
              badge.textContent = 'Copy failed';
              row.appendChild(badge);
            }
            badge.style.opacity = '1';
            setTimeout(() => badge.style.opacity = '0', 1200);
          }
        });

        row.appendChild(inp);
        return row;
      }

      // Perform the DNS over HTTPS query to Google DNS JSON endpoint
      async function performLookup() {
        const name = input.value.trim();
        if (!name) {
          showMessage('Please enter a domain or hostname to look up.', 'danger');
          return;
        }

        clearResults();
        setLoading(true);

        // Use Google's JSON DNS resolver endpoint per request
        const url = 'https://dns.google/resolve?name=' + encodeURIComponent(name) + '&type=A';

        try {
          const resp = await fetch(url, { method: 'GET' });
          if (!resp.ok) {
            showMessage('Network error: ' + resp.status + ' ' + resp.statusText, 'danger');
            return;
          }

          const json = await resp.json();

          // Validate Answer field and that it's an array
          if (!('Answer' in json) || !Array.isArray(json.Answer)) {
            // Provide some debugging info if available
            const rcodeText = json.Status !== undefined ? (' (Status=' + json.Status + ')') : '';
            showMessage('No Answer array found in response' + rcodeText + '.', 'secondary');
            return;
          }

          // Create rows for each answer.data
          clearResults();
          if (json.Answer.length === 0) {
            showMessage('Answer array present but empty.', 'secondary');
            return;
          }

          json.Answer.forEach(ans => {
            // Each answer is an object; read its data field
            if (ans && typeof ans.data === 'string') {
              const row = createResultRow(ans.data);
              results.appendChild(row);
            } else {
              // If data isn't present, show the whole record for debugging
              const row = createResultRow(JSON.stringify(ans));
              results.appendChild(row);
            }
          });

        } catch (err) {
          console.error(err);
          showMessage('Error: ' + err.message, 'danger');
        } finally {
          setLoading(false);
        }
      }

      // Event listeners
      btn.addEventListener('click', performLookup);

      // Enter key triggers search
      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          performLookup();
        }
      });

      // initial hint remains in placeholder until first search
      input.addEventListener('input', () => {
        // remove placeholder if user types
        if (placeholder) {
          placeholder.style.display = 'none';
        }
      });

      // Trigger performLookup when document is ready
      document.addEventListener('DOMContentLoaded', function () {
        performLookup();
      });
    })();
  </script>
</body>

</html>